{"ast":null,"code":"import IconFinder from'@components/Icon';import Pagination from'@components/Pagination';import{useSnackbar}from'@components/Snackbar';import Table from'@components/Table';import{PoppinsTypography}from'@components/Typography';import Uploader from'@components/Uploader';import{useGetAllNotificationApi,useGetAllNotificationByIdApi,useQwickSendApi}from'@hooks/admin-notifications';import{LoadingButton}from'@mui/lab';import{Dialog,DialogContent,DialogTitle,IconButton,Stack,TextField,useTheme}from'@mui/material';import{generateSerialNumber}from'@utils/common';import moment from'moment';import{memo,useRef,useState}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AllNotifications(props){var _searchInputRef$curre,_GetAllNotificationAp,_GetAllNotificationAp2,_GetAllNotificationAp7,_GetAllNotificationAp8;const theme=useTheme();const{showSnackbar,hideSnackbar}=useSnackbar();const QwickSendApi=useQwickSendApi();const searchInputRef=useRef(null);const[pageRequest,setPageRequest]=useState({page:1,size:10});const[sortRequest,setSortRequest]=useState({});const[openPreview,setOpenPreview]=useState(false);const GetAllNotificationApi=useGetAllNotificationApi({...pageRequest,...sortRequest,search:(_searchInputRef$curre=searchInputRef.current)===null||_searchInputRef$curre===void 0?void 0:_searchInputRef$curre.value});const handleKeyDown=event=>{if(event.key==='Enter'){void GetAllNotificationApi.refetch();}};const handlePage=page=>{setPageRequest({...pageRequest,page});};const rows=(_GetAllNotificationAp=(_GetAllNotificationAp2=GetAllNotificationApi.data)===null||_GetAllNotificationAp2===void 0?void 0:_GetAllNotificationAp2.data.data)!==null&&_GetAllNotificationAp!==void 0?_GetAllNotificationAp:[];const columns=[{field:'SL No',renderHeader:()=>\"SL No\",renderCell:_ref=>{var _GetAllNotificationAp3,_GetAllNotificationAp4,_GetAllNotificationAp5,_GetAllNotificationAp6;let{rowNumber}=_ref;return generateSerialNumber((_GetAllNotificationAp3=(_GetAllNotificationAp4=GetAllNotificationApi.data)===null||_GetAllNotificationAp4===void 0?void 0:_GetAllNotificationAp4.data.page)!==null&&_GetAllNotificationAp3!==void 0?_GetAllNotificationAp3:0,(_GetAllNotificationAp5=(_GetAllNotificationAp6=GetAllNotificationApi.data)===null||_GetAllNotificationAp6===void 0?void 0:_GetAllNotificationAp6.data.size)!==null&&_GetAllNotificationAp5!==void 0?_GetAllNotificationAp5:0,rowNumber);}},{field:'header',renderHeader:()=>\"Header\",renderCell:_ref2=>{let{row}=_ref2;return row.message_title;},sortable:true},{field:'info_text',renderHeader:()=>\"Info Text\",renderCell:_ref3=>{let{row}=_ref3;return row.message_info_text;},sortable:true},{field:'body_type',renderHeader:()=>\"Body Type\",renderCell:_ref4=>{let{row}=_ref4;return row.message_body_type;}},{field:'category',renderHeader:()=>\"Category\",renderCell:_ref5=>{let{row}=_ref5;return row.message_category;}},{field:'time',renderHeader:()=>\"Time\",renderCell:_ref6=>{let{row}=_ref6;return row.schedule_time===null?'Instant':moment(row.schedule_time).format('DD MMM, H A');}},{field:'status',renderHeader:()=>\"Status\",renderCell:_ref7=>{let{row}=_ref7;return/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",sx:{color:row.message_status==='Sent'?theme.palette.success.main:theme.palette.warning.main},children:row.message_status});}},{field:'action',renderHeader:()=>\"Quick Action\",renderCell:_ref8=>{let{row}=_ref8;return/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',gap:1,children:[/*#__PURE__*/_jsx(IconFinder,{iconName:\"OpenEye\",iconProps:{fill:theme.palette.secondary.main,cursor:'pointer',onClick:()=>setOpenPreview(row.notification_id)}}),/*#__PURE__*/_jsx(IconFinder,{iconName:\"Pen\",iconProps:{cursor:'pointer',onClick:()=>props.isToUpdate(row.notification_id)}}),/*#__PURE__*/_jsx(IconFinder,{iconName:\"Send\",iconProps:{cursor:'pointer',onClick:()=>onQwickSendClick(row)}})]});}}];const onCancelSearch=()=>{var _searchInputRef$curre2,_searchInputRef$curre3;if((_searchInputRef$curre2=searchInputRef.current)!==null&&_searchInputRef$curre2!==void 0&&_searchInputRef$curre2.value||((_searchInputRef$curre3=searchInputRef.current)===null||_searchInputRef$curre3===void 0?void 0:_searchInputRef$curre3.value)!==''){searchInputRef.current.value='';void GetAllNotificationApi.refetch();}};const onQwickSendClick=data=>{QwickSendApi.mutateAsync({id:data.notification_id,request:data}).then(response=>{var _response$data;showSnackbar({title:'Success!',variant:'sucess',content:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.message,onCancel:()=>hideSnackbar()});void GetAllNotificationApi.refetch();}).catch(error=>{var _error$response,_error$response$data;showSnackbar({title:'Error!',variant:'error',content:(_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message,onCancel:()=>hideSnackbar()});});};return/*#__PURE__*/_jsxs(Stack,{gap:1,flexGrow:'inherit',children:[/*#__PURE__*/_jsx(Stack,{gap:2,flexDirection:'row',alignSelf:'self-end',children:/*#__PURE__*/_jsx(TextField,{size:\"small\",placeholder:\"Search...\",autoComplete:\"off\",InputProps:{startAdornment:/*#__PURE__*/_jsx(IconFinder,{iconName:\"Search\"}),endAdornment:/*#__PURE__*/_jsx(IconButton,{size:\"small\",sx:{padding:\"4px\"},onClick:onCancelSearch,children:/*#__PURE__*/_jsx(IconFinder,{iconName:\"Cancel\"})})},inputRef:searchInputRef,onKeyDown:handleKeyDown,sx:{'.MuiInputBase-input':{paddingLeft:1},'.MuiOutlinedInput-notchedOutline':{borderColor:'#E9ECEF'}}})}),/*#__PURE__*/_jsx(Table,{rows:rows,columns:columns,rowId:row=>row.id,tableProps:{size:'small',stickyHeader:false},tableRowProps:{hover:true},onSortChange:sort=>{setSortRequest({sort_by:sort===null||sort===void 0?void 0:sort.field,order:sort===null||sort===void 0?void 0:sort.order});},loading:GetAllNotificationApi.isLoading}),/*#__PURE__*/_jsx(Stack,{children:/*#__PURE__*/_jsx(Pagination,{page:pageRequest.page,size:(_GetAllNotificationAp7=GetAllNotificationApi.data)===null||_GetAllNotificationAp7===void 0?void 0:_GetAllNotificationAp7.data.size,totalPages:(_GetAllNotificationAp8=GetAllNotificationApi.data)===null||_GetAllNotificationAp8===void 0?void 0:_GetAllNotificationAp8.data.pagesTotal,onPageChange:handlePage})}),/*#__PURE__*/_jsx(NotificationPreviewDialog,{open:openPreview,handleClose:()=>setOpenPreview(false)})]});}export default/*#__PURE__*/memo(AllNotifications);const NotificationPreviewDialog=props=>{var _GetAllNotificationBy,_data$message_img;const theme=useTheme();const GetAllNotificationByIdApi=useGetAllNotificationByIdApi(props.open);const data=(_GetAllNotificationBy=GetAllNotificationByIdApi.data)===null||_GetAllNotificationBy===void 0?void 0:_GetAllNotificationBy.data.data;return/*#__PURE__*/_jsxs(Dialog,{onClose:props.handleClose,open:Boolean(props.open),maxWidth:\"sm\",sx:{'.MuiDialog-paper':{width:646}},children:[/*#__PURE__*/_jsx(DialogTitle,{sx:{padding:4,paddingBottom:3},children:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",align:\"center\",sx:{color:theme.palette.common.secondaryGreyText},children:\"Notification Preview\"})}),/*#__PURE__*/_jsxs(DialogContent,{sx:{display:'flex',flexDirection:'column',gap:4,padding:4},children:[/*#__PURE__*/_jsxs(Stack,{alignItems:'center',children:[/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",fontSize:24,fontWeight:600,sx:{color:theme.palette.common.primaryGreyText},children:data===null||data===void 0?void 0:data.message_title}),/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"caption\",sx:{color:theme.palette.common.primaryGreyText},children:data===null||data===void 0?void 0:data.message_info_text})]}),/*#__PURE__*/_jsxs(Stack,{alignItems:'center',gap:2,children:[/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",sx:{color:theme.palette.common.primaryGreyText},children:data===null||data===void 0?void 0:data.message_body}),/*#__PURE__*/_jsx(Uploader,{fieldName:\"message_img\",sx:{flexDirection:'column',alignItems:'center',placeContent:'center',width:440,height:196,borderRadius:'16px',borderStyle:'solid',borderWidth:'1px',borderColor:theme.palette.primary.main},file:(_data$message_img=data===null||data===void 0?void 0:data.message_img)!==null&&_data$message_img!==void 0?_data$message_img:''})]}),/*#__PURE__*/_jsx(Stack,{flexDirection:'row',gap:2,alignSelf:'center',paddingTop:\"32px\",children:/*#__PURE__*/_jsx(LoadingButton,{variant:\"contained\",size:\"large\",sx:{width:166,height:46,borderRadius:\"4px\"},onClick:props.handleClose,children:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",children:\"Ok\"})})})]})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}