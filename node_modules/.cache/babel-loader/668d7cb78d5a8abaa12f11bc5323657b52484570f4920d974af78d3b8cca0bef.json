{"ast":null,"code":"import IconFinder from'@components/Icon';import InputField from'@components/InputField';import{FiraSansTypography}from'@components/Typography';import Uploader from'@components/Uploader';import{Divider,Radio,Stack,useTheme}from'@mui/material';import{validateAmount,validateIsPrice}from'@utils/validator';import{memo,useEffect,useState}from'react';import PaymentSuccess from'./PaymentSuccess';import{useAddCashTransationApi,useGenerateOrderIdApi,useGetDeepLinkInfoApi,useVerifyCashTransationApi,useVerifyPaymentApi}from'@hooks/user-app-payment';import{useNavigate,useSearchParams}from'react-router-dom';import{useAlertDialog}from'@components/AlertDialog';import UserAppWrapper from'@components/UserAppWrapper';import OTPField,{OTPFormData}from'@components/OTPField';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const intialFormData={amount:''};const intialFormError={amount:''};const PayTo=()=>{var _GetDeepLinkInfoApi$d,_GetDeepLinkInfoApi$d8,_data$restaurant_prof;const theme=useTheme();const navigate=useNavigate();const[searchParams]=useSearchParams();const{showAlertDialog,hideAlertDialog}=useAlertDialog();const GetDeepLinkInfoApi=useGetDeepLinkInfoApi(searchParams===null||searchParams===void 0?void 0:searchParams.get('key'));const GenerateOrderIdApi=useGenerateOrderIdApi();const VerifyPaymentApi=useVerifyPaymentApi();const AddCashTransationApi=useAddCashTransationApi();const VerifyCashTransationApi=useVerifyCashTransationApi();const[paymentMode,setPaymentMode]=useState('online');const[transactionId,setTransactionId]=useState('');const[otp,setOtp]=useState(OTPFormData);const[formData,setFormData]=useState(intialFormData);const[formError,setFormError]=useState(intialFormError);const data=(_GetDeepLinkInfoApi$d=GetDeepLinkInfoApi.data)===null||_GetDeepLinkInfoApi$d===void 0?void 0:_GetDeepLinkInfoApi$d.data.data;const showOtp=Boolean(transactionId);const onChange=(fieldName,value,fieldType)=>{let _formData={...formData,[fieldName]:value};if(fieldType==='number'){const isNumber=validateIsPrice(String(value));_formData={...formData,[fieldName]:isNumber?value:formData[fieldName]};}else{_formData={...formData,[fieldName]:value};}setFormData(_formData);setFormError({...formError,[fieldName]:validateAmount(value)});};const onPayClick=()=>{if(paymentMode==='online'){payOnline();}else{payCash();}};const payCash=()=>{var _GetDeepLinkInfoApi$d2,_GetDeepLinkInfoApi$d3;AddCashTransationApi.mutateAsync({request:{amount:formData.amount,restaurant_id:(_GetDeepLinkInfoApi$d2=(_GetDeepLinkInfoApi$d3=GetDeepLinkInfoApi.data)===null||_GetDeepLinkInfoApi$d3===void 0?void 0:_GetDeepLinkInfoApi$d3.data.data.restaurant_id)!==null&&_GetDeepLinkInfoApi$d2!==void 0?_GetDeepLinkInfoApi$d2:''}}).then(res=>{var _res$data;setTransactionId(res.data.transaction_id);showAlertDialog({title:res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.message,buttons:[{children:'ok',variant:'outlined',callback:()=>{hideAlertDialog();}}]});}).catch(error=>{var _error$response,_error$response$data;showAlertDialog({title:error===null||error===void 0?void 0:(_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message,buttons:[{children:'ok',variant:'outlined',callback:()=>{hideAlertDialog();}}]});});};const payOnline=()=>{var _GetDeepLinkInfoApi$d4,_GetDeepLinkInfoApi$d5;GenerateOrderIdApi.mutateAsync({request:{amount:formData.amount,restaurant_id:(_GetDeepLinkInfoApi$d4=(_GetDeepLinkInfoApi$d5=GetDeepLinkInfoApi.data)===null||_GetDeepLinkInfoApi$d5===void 0?void 0:_GetDeepLinkInfoApi$d5.data.data.restaurant_id)!==null&&_GetDeepLinkInfoApi$d4!==void 0?_GetDeepLinkInfoApi$d4:''}}).then(res=>{var _GetDeepLinkInfoApi$d6,_GetDeepLinkInfoApi$d7,_objectForSending$key,_objectForSending$amo,_objectForSending$ord,_objectForSending$cal;const order_id=res.data.order_id;const objectForSending={key_id:'rzp_test_bKbGnqnewD4zgf',amount:Number(res.data.amount)*100,//callback_url: 'http://localhost:3000/payments/error',\n//callback_url: 'http://localhost:3001/payments/error?order_id=' + `${res.data.order_id}`,\n//callback_url:\n//\t'https://wellplayed.innvotix.in/payments/error?order_id=' + `${res.data.order_id}`,\ncallback_url:'https://api.makemybucks.com/verify_payment_new/?order_id='+\"\".concat(res.data.order_id)+'&restaurant_id='+\"\".concat((_GetDeepLinkInfoApi$d6=(_GetDeepLinkInfoApi$d7=GetDeepLinkInfoApi.data)===null||_GetDeepLinkInfoApi$d7===void 0?void 0:_GetDeepLinkInfoApi$d7.data.data.restaurant_id)!==null&&_GetDeepLinkInfoApi$d6!==void 0?_GetDeepLinkInfoApi$d6:'')+'&amount='+\"\".concat(res.data.amount)+'&currency=INR'+'&user_id='+\"\".concat(res.data.user_id)+'&payment_type=online',name:'',description:'','prefill[email]':'','prefill[contact]':res.data.phone_no,order_id:res.data.order_id};const form=document.createElement('form');form.method='POST';form.action='https://api.razorpay.com/v1/checkout/embedded';// Sample 1\nconst hiddenFieldSample1=document.createElement('input');hiddenFieldSample1.type='hidden';hiddenFieldSample1.name='key_id';hiddenFieldSample1.value=(_objectForSending$key=objectForSending.key_id)===null||_objectForSending$key===void 0?void 0:_objectForSending$key.toString();form.appendChild(hiddenFieldSample1);// Sample 2\nconst hiddenFieldSample2=document.createElement('input');hiddenFieldSample2.type='hidden';hiddenFieldSample2.name='amount';hiddenFieldSample2.value=(_objectForSending$amo=objectForSending.amount)===null||_objectForSending$amo===void 0?void 0:_objectForSending$amo.toString();form.appendChild(hiddenFieldSample2);// order_id\nconst hiddenFieldorder_id=document.createElement('input');hiddenFieldorder_id.type='hidden';hiddenFieldorder_id.name='order_id';hiddenFieldorder_id.value=(_objectForSending$ord=objectForSending.order_id)===null||_objectForSending$ord===void 0?void 0:_objectForSending$ord.toString();form.appendChild(hiddenFieldorder_id);// callback_url\nconst hiddenFieldcallback_url=document.createElement('input');hiddenFieldcallback_url.type='hidden';hiddenFieldcallback_url.name='callback_url';hiddenFieldcallback_url.value=(_objectForSending$cal=objectForSending.callback_url)===null||_objectForSending$cal===void 0?void 0:_objectForSending$cal.toString();form.appendChild(hiddenFieldcallback_url);// callback_url\nconst hiddenFieldcallemail=document.createElement('input');hiddenFieldcallemail.type='hidden';hiddenFieldcallemail.name='prefill[email]';hiddenFieldcallemail.value='lksh7264@gmail.com';form.appendChild(hiddenFieldcallemail);// callback_url\nconst hiddenFieldcallphone=document.createElement('input');hiddenFieldcallphone.type='hidden';hiddenFieldcallphone.name='prefill[contact]';hiddenFieldcallphone.value=res.data.phone_no.toString();form.appendChild(hiddenFieldcallphone);document.body.appendChild(form);form.submit();// const _window: (Window & typeof globalThis) | any = window;\n// const Razorpay: any = _window.Razorpay;\n// const razorpay = new Razorpay({\n// \tkey: process.env.REACT_APP_PAYMENT_GATEWAY_KEY,\n// \tamount: Number(res.data.amount) * 100,\n// \tcurrency: 'INR',\n// \torder_id: res.data.order_id,\n// \tprefill: {\n// \t\tcontact: res.data.phone_no,\n// \t},\n// \ttheme: {\n// \t\tcolor: '#A9A7E8',\n// \t},\n// \timage: 'https://makemybucks.openuidev.com/logo192.png',\n// \thandler: (response: VerifyPaymentRequest) => {\n// \t\tVerifyPaymentApi.mutate({\n// \t\t\trequest: {\n// \t\t\t\t...response,\n// \t\t\t\tamount: res.data.amount,\n// \t\t\t\tcurrency: 'INR',\n// \t\t\t\tpayment_type: 'online',\n// \t\t\t\trestaurant_id: GetDeepLinkInfoApi.data?.data.data.restaurant_id ?? '',\n// \t\t\t},\n// \t\t});\n// \t},\n// \tredirect: false,\n// \tretry: {\n// \t\tenabled: false,\n// \t},\n// });\n// razorpay.open();\n// razorpay.on('payment.failed', (response: any) => {\n// \tshowAlertDialog({\n// \t\ttitle: response?.error?.description,\n// \t\tbuttons: [\n// \t\t\t{\n// \t\t\t\tchildren: 'ok',\n// \t\t\t\tvariant: 'outlined',\n// \t\t\t\tcallback: () => {\n// \t\t\t\t\thideAlertDialog();\n// \t\t\t\t},\n// \t\t\t},\n// \t\t],\n// \t});\n// });\n}).catch(error=>{var _error$response2,_error$response2$data;showAlertDialog({title:error===null||error===void 0?void 0:(_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message,buttons:[{children:'ok',variant:'outlined',callback:()=>{hideAlertDialog();}}]});});};const handleBack=()=>{if(showOtp){setTransactionId('');setOtp({});}else{navigate(\"/payments?key=\".concat(searchParams===null||searchParams===void 0?void 0:searchParams.get('key')));}};const handleVerifyOTP=()=>{VerifyCashTransationApi.mutate({request:{cash_otp:Object.values(otp).join(''),transaction_id:transactionId}});};useEffect(()=>{void loadPaymentGateway();},[]);return VerifyPaymentApi.isSuccess||VerifyCashTransationApi.isSuccess?/*#__PURE__*/_jsx(PaymentSuccess,{data:{amount:formData.amount,...(GetDeepLinkInfoApi===null||GetDeepLinkInfoApi===void 0?void 0:(_GetDeepLinkInfoApi$d8=GetDeepLinkInfoApi.data)===null||_GetDeepLinkInfoApi$d8===void 0?void 0:_GetDeepLinkInfoApi$d8.data.data)}}):/*#__PURE__*/_jsx(UserAppWrapper,{controlButtonProps:{content:showOtp?\"Verify OTP\":\"Proceed to Pay\",onClick:showOtp?handleVerifyOTP:onPayClick,loading:GenerateOrderIdApi.isLoading||VerifyPaymentApi.isLoading,disabled:GetDeepLinkInfoApi.isError},handleBack:handleBack,heading:showOtp?/*#__PURE__*/_jsx(FiraSansTypography,{fontSize:\"18px\",fontWeight:600,letterSpacing:0.64,children:\"Back\"}):/*#__PURE__*/_jsx(FiraSansTypography,{variant:\"h4\",fontWeight:600,letterSpacing:0.64,children:\"Paying to\"}),children:showOtp?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Stack,{gap:5,children:[/*#__PURE__*/_jsxs(Stack,{children:[/*#__PURE__*/_jsx(FiraSansTypography,{variant:\"h4\",fontWeight:600,sx:{color:theme.palette.common.white},children:\"Verify cash Payment\"}),/*#__PURE__*/_jsx(FiraSansTypography,{variant:\"subtitle2\",sx:{color:theme.palette.common.primaryGreyText},display:'flex',gap:1,children:\"OTP Sent to Restaurant Manager\"})]}),/*#__PURE__*/_jsx(OTPField,{otp:otp,setOtp:setOtp,onEnter:handleVerifyOTP})]})}):/*#__PURE__*/_jsxs(Stack,{gap:5,paddingTop:\"100px\",flexGrow:1,children:[/*#__PURE__*/_jsxs(Stack,{alignItems:'center',gap:1,children:[/*#__PURE__*/_jsx(Uploader,{fieldName:\"restaurant_img\",sx:{placeContent:'flex-end',height:68,width:68,borderRadius:'16px',justifyContent:'center',alignItems:'center'},file:(_data$restaurant_prof=data===null||data===void 0?void 0:data.restaurant_profile)!==null&&_data$restaurant_prof!==void 0?_data$restaurant_prof:''}),/*#__PURE__*/_jsx(FiraSansTypography,{variant:\"h4\",fontWeight:600,fontSize:24,sx:{color:theme.palette.common.white},children:data===null||data===void 0?void 0:data.restaurant_name}),/*#__PURE__*/_jsx(FiraSansTypography,{variant:\"subtitle1\",sx:{color:theme.palette.common.primaryGreyText},children:data===null||data===void 0?void 0:data.address})]}),/*#__PURE__*/_jsxs(Stack,{alignItems:'center',gap:1,children:[/*#__PURE__*/_jsx(InputField,{fieldName:\"amount\",value:formData.amount,fieldType:\"number\",fieldProps:{placeholder:'0',size:'medium',inputProps:{inputMode:'numeric'},InputProps:{startAdornment:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(IconFinder,{iconName:\"RupeeV3\",iconProps:{width:\"50px\"}}),/*#__PURE__*/_jsx(Divider,{orientation:\"vertical\",sx:{borderColor:theme.palette.common.white,height:\"62px\",padding:'inherit'}})]})},error:Boolean(formError.amount),helperText:formError.amount,sx:{width:130+formData.amount.length*30,'& .MuiInputBase-input':{height:44,fontSize:64,fontWeight:900,fontFamily:'Fira Sans'},'& .MuiOutlinedInput-notchedOutline':{borderColor:'transparent !important'},'& .MuiOutlinedInput-input':{paddingLeft:'inherit'}}},onChange:onChange}),/*#__PURE__*/_jsx(FiraSansTypography,{variant:\"h6\",sx:{color:theme.palette.common.primaryGreyText},children:\"Enter amount\"})]}),/*#__PURE__*/_jsxs(Stack,{marginTop:'auto',children:[/*#__PURE__*/_jsx(FiraSansTypography,{variant:\"subtitle1\",sx:{color:theme.palette.common.primaryGreyText},children:\"Payment mode\"}),/*#__PURE__*/_jsxs(Stack,{bgcolor:'#333335',borderRadius:\"16px\",padding:3,gap:3,children:[/*#__PURE__*/_jsxs(Stack,{onClick:()=>setPaymentMode('online'),children:[/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',justifyContent:'space-between',children:[/*#__PURE__*/_jsx(FiraSansTypography,{fontSize:\"18px\",sx:{color:theme.palette.common.white},children:\"Online\"}),/*#__PURE__*/_jsx(Radio,{sx:{paddingTop:0},checked:paymentMode==='online'})]}),/*#__PURE__*/_jsx(IconFinder,{iconName:\"UPIList\"})]}),/*#__PURE__*/_jsx(Divider,{sx:{borderColor:'#515152'}}),/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',justifyContent:'space-between',onClick:()=>setPaymentMode('cash'),children:[/*#__PURE__*/_jsx(FiraSansTypography,{fontSize:\"18px\",sx:{color:theme.palette.common.white},children:\"Cash\"}),/*#__PURE__*/_jsx(Radio,{sx:{paddingTop:0},checked:paymentMode==='cash'})]})]})]})]})});};export default/*#__PURE__*/memo(PayTo);export const loadPaymentGateway=()=>{return new Promise(resolve=>{const script=document.createElement('script');script.src='https://checkout.razorpay.com/v1/checkout.js';script.type='text/javascript';script.onload=()=>{resolve(true);};script.onerror=()=>{resolve(false);};document.head.appendChild(script);});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}