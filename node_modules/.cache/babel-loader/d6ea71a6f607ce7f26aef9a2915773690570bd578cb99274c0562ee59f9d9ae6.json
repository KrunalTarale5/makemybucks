{"ast":null,"code":"import{InterTypography,PoppinsTypography}from'@components/Typography';import{BannerInformation,useBannerInfo}from'@hooks/admin-banner-info';import{Button,Chip,Dialog,DialogContent,DialogTitle,Divider,IconButton,Menu,MenuItem,Stack,useTheme}from'@mui/material';// eslint-disable-next-line import/default\nimport Chart from'react-apexcharts';import{useState,memo}from'react';import moment,{months}from'moment';import IconFinder from'@components/Icon';import{LoadingButton}from'@mui/lab';import{YearPicker}from'@components/DatePicker';import{LocalizationProvider,StaticDatePicker}from'@mui/x-date-pickers';import{AdapterMoment}from'@mui/x-date-pickers/AdapterMoment';import{DemoContainer}from'@mui/x-date-pickers/internals/demo';import{useDownloadReportApi,useGetTotalPaybackCoordApi,useGetTotalUserCoordApi}from'@hooks/admin-reports';import{useSnackbar}from'@components/Snackbar';import{getMaxTickAmount}from'@utils/common';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const REPORT_TYPE=['Daily','Monthly','Quarterly'];const REPORTS=['GST Return','Monthly TDS Return','Quarterly TDS Return','Customer Disbursement','Restaurant Disbursement','Discount Structure Savings','Vendor Payment','Restaurant Incentive','Monthly Restaurant transaction','Restaurant Membership Profit'];const Reports=()=>{var _investmentReport$dat,_totalTransationRepor,_totalTransationRepor2,_GetTotalUserCoordApi,_GetTotalUserCoordApi2,_GetTotalUserCoordApi3,_GetTotalUserCoordApi4,_GetTotalUserCoordApi5,_GetTotalUserCoordApi6,_GetTotalUserCoordApi7,_GetTotalUserCoordApi8,_GetTotalUserCoordApi9,_GetTotalPaybackCoord,_GetTotalPaybackCoord2,_GetTotalPaybackCoord3,_GetTotalPaybackCoord4,_GetTotalPaybackCoord5,_GetTotalPaybackCoord6,_GetTotalPaybackCoord7,_GetTotalPaybackCoord8,_GetTotalPaybackCoord9;const theme=useTheme();useBannerInfo(BannerInformation.reports);const[downloadPopup,setDownloadPopup]=useState(false);const[anchorEl,handleAnchorEl]=useState(null);const[totalTransationReport,setTotalTransationReport]=useState({date:moment(),type:'Daily'});const[investmentReport,setInvestmentReport]=useState({date:moment(),type:'Daily'});const GetTotalPaybackCoordApi=useGetTotalPaybackCoordApi({filter:investmentReport.type.toLowerCase(),calendar:'year',year:(_investmentReport$dat=investmentReport.date)===null||_investmentReport$dat===void 0?void 0:_investmentReport$dat.get('year').toString()});const GetTotalUserCoordApi=useGetTotalUserCoordApi({filter:totalTransationReport.type.toLowerCase(),calendar:'year',year:(_totalTransationRepor=totalTransationReport.date)===null||_totalTransationRepor===void 0?void 0:_totalTransationRepor.get('year').toString(),month:(_totalTransationRepor2=totalTransationReport.date)===null||_totalTransationRepor2===void 0?void 0:_totalTransationRepor2.format('MMMM')});const onDownloadClick=report=>()=>{setDownloadPopup(report);};return/*#__PURE__*/_jsxs(Stack,{gap:5,paddingTop:6,paddingBottom:3,children:[/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',gap:2,children:[/*#__PURE__*/_jsxs(Stack,{boxShadow:'0px 2px 8px 0px #00000026',padding:1.3,flexBasis:\"60%\",gap:2,children:[/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',justifyContent:'space-between',children:[/*#__PURE__*/_jsx(InterTypography,{fontWeight:600,variant:\"subtitle1\",children:\"Total Transaction/no. of users\"}),/*#__PURE__*/_jsxs(Stack,{gap:1,flexDirection:'row',children:[REPORT_TYPE.filter(f=>f==='Monthly'||f==='Daily').map(r=>/*#__PURE__*/_jsx(Chip,{size:\"small\",label:r,sx:{fontSize:7,backgroundColor:totalTransationReport.type===r?'#E7EBFE':'transparent'},onClick:()=>setTotalTransationReport({...totalTransationReport,type:r})},r)),/*#__PURE__*/_jsx(YearPicker,{onRightClick:()=>setTotalTransationReport({...totalTransationReport,date:moment(totalTransationReport.date).add(1,'year')}),onLeftClick:()=>setTotalTransationReport({...totalTransationReport,date:moment(totalTransationReport.date).subtract(1,'year')}),onCalenderClick:e=>handleAnchorEl({element:e.currentTarget,box:1}),onChange:value=>{setTotalTransationReport({...totalTransationReport,date:value});handleAnchorEl(null);},show:Boolean(anchorEl)&&(anchorEl===null||anchorEl===void 0?void 0:anchorEl.box)===1,handleClose:()=>handleAnchorEl(null),anchorEl:anchorEl===null||anchorEl===void 0?void 0:anchorEl.element,date:totalTransationReport.date}),/*#__PURE__*/_jsx(IconFinder,{iconName:\"MoreVertical\",iconProps:{height:24,fill:'black'}})]})]}),/*#__PURE__*/_jsx(Chart,{options:{chart:{zoom:{enabled:false}},dataLabels:{enabled:false},xaxis:{categories:(_GetTotalUserCoordApi=(_GetTotalUserCoordApi2=GetTotalUserCoordApi.data)===null||_GetTotalUserCoordApi2===void 0?void 0:(_GetTotalUserCoordApi3=_GetTotalUserCoordApi2.data.data)===null||_GetTotalUserCoordApi3===void 0?void 0:_GetTotalUserCoordApi3.x_axis)!==null&&_GetTotalUserCoordApi!==void 0?_GetTotalUserCoordApi:[]},yaxis:{labels:{formatter:value=>value===null||value===void 0?void 0:value.toFixed(0)},tickAmount:getMaxTickAmount((_GetTotalUserCoordApi4=(_GetTotalUserCoordApi5=GetTotalUserCoordApi.data)===null||_GetTotalUserCoordApi5===void 0?void 0:(_GetTotalUserCoordApi6=_GetTotalUserCoordApi5.data.data)===null||_GetTotalUserCoordApi6===void 0?void 0:_GetTotalUserCoordApi6.y_axis)!==null&&_GetTotalUserCoordApi4!==void 0?_GetTotalUserCoordApi4:[])},tooltip:{enabled:true,followCursor:true},colors:[theme.palette.primary.main]},series:[{name:'Total Transaction/no. of users',data:(_GetTotalUserCoordApi7=(_GetTotalUserCoordApi8=GetTotalUserCoordApi.data)===null||_GetTotalUserCoordApi8===void 0?void 0:(_GetTotalUserCoordApi9=_GetTotalUserCoordApi8.data.data)===null||_GetTotalUserCoordApi9===void 0?void 0:_GetTotalUserCoordApi9.y_axis)!==null&&_GetTotalUserCoordApi7!==void 0?_GetTotalUserCoordApi7:[]}],type:\"area\",height:365/* \twidth={952} */})]}),/*#__PURE__*/_jsx(Stack,{boxShadow:'0px 2px 8px 0px #00000026',padding:1.3,flexBasis:\"40%\",children:/*#__PURE__*/_jsxs(Stack,{gap:2,children:[/*#__PURE__*/_jsxs(Stack,{justifyContent:'space-between',flexDirection:'row',children:[/*#__PURE__*/_jsx(InterTypography,{fontWeight:600,variant:\"subtitle1\",children:\"Investment/payback\"}),/*#__PURE__*/_jsx(IconFinder,{iconName:\"MoreVertical\",iconProps:{height:24,fill:'black'}})]}),/*#__PURE__*/_jsxs(Stack,{justifyContent:'space-between',flexDirection:'row',children:[/*#__PURE__*/_jsx(Stack,{gap:1,flexDirection:'row',children:REPORT_TYPE.map(c=>/*#__PURE__*/_jsx(Chip,{size:\"medium\",label:c,sx:{fontSize:10,height:27,backgroundColor:investmentReport.type===c?'#E7EBFE':'transparent'},onClick:()=>setInvestmentReport({...investmentReport,type:c})},c))}),/*#__PURE__*/_jsx(YearPicker,{onRightClick:()=>setInvestmentReport({...investmentReport,date:moment(investmentReport.date).add(1,'year')}),onLeftClick:()=>setInvestmentReport({...investmentReport,date:moment(investmentReport.date).subtract(1,'year')}),onCalenderClick:e=>handleAnchorEl({element:e.currentTarget,box:2}),onChange:value=>{setInvestmentReport({...investmentReport,date:value});handleAnchorEl(null);},show:Boolean(anchorEl)&&(anchorEl===null||anchorEl===void 0?void 0:anchorEl.box)===2,handleClose:()=>handleAnchorEl(null),anchorEl:anchorEl===null||anchorEl===void 0?void 0:anchorEl.element,date:investmentReport.date,position:{left:100}})]}),/*#__PURE__*/_jsx(Chart,{options:{chart:{zoom:{enabled:false}},dataLabels:{enabled:false},xaxis:{categories:(_GetTotalPaybackCoord=(_GetTotalPaybackCoord2=GetTotalPaybackCoordApi.data)===null||_GetTotalPaybackCoord2===void 0?void 0:(_GetTotalPaybackCoord3=_GetTotalPaybackCoord2.data.data)===null||_GetTotalPaybackCoord3===void 0?void 0:_GetTotalPaybackCoord3.x_axis)!==null&&_GetTotalPaybackCoord!==void 0?_GetTotalPaybackCoord:[]},yaxis:{labels:{formatter:value=>value===null||value===void 0?void 0:value.toFixed(0)},tickAmount:getMaxTickAmount((_GetTotalPaybackCoord4=(_GetTotalPaybackCoord5=GetTotalPaybackCoordApi.data)===null||_GetTotalPaybackCoord5===void 0?void 0:(_GetTotalPaybackCoord6=_GetTotalPaybackCoord5.data.data)===null||_GetTotalPaybackCoord6===void 0?void 0:_GetTotalPaybackCoord6.y_axis)!==null&&_GetTotalPaybackCoord4!==void 0?_GetTotalPaybackCoord4:[])},tooltip:{enabled:true,followCursor:true},colors:[theme.palette.primary.main]},series:[{name:'Investment/payback',data:(_GetTotalPaybackCoord7=(_GetTotalPaybackCoord8=GetTotalPaybackCoordApi.data)===null||_GetTotalPaybackCoord8===void 0?void 0:(_GetTotalPaybackCoord9=_GetTotalPaybackCoord8.data.data)===null||_GetTotalPaybackCoord9===void 0?void 0:_GetTotalPaybackCoord9.y_axis)!==null&&_GetTotalPaybackCoord7!==void 0?_GetTotalPaybackCoord7:[]}],type:\"bar\",height:321})]})})]}),/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',justifyContent:'space-between',alignItems:'center',children:[/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",sx:{color:theme.palette.common.primaryGreyText},children:\"Download Reports\"}),/*#__PURE__*/_jsx(Divider,{orientation:\"horizontal\"/* sx={{ width: `83%` }} */}),/*#__PURE__*/_jsx(IconFinder,{iconName:\"ChevronDown\",iconProps:{fill:'black'}})]}),/*#__PURE__*/_jsx(Stack,{flexDirection:'row',flexWrap:'wrap',gap:1,children:REPORTS.map(r=>/*#__PURE__*/_jsxs(Stack,{height:64,border:\"1px solid #C1C0CB\",borderRadius:\"6px\",flexDirection:'row',justifyContent:'space-between',alignItems:'center',paddingX:\"23px\",flexBasis:\"33%\",children:[/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",sx:{color:theme.palette.common.primaryGreyText},children:r}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:onDownloadClick(r),children:/*#__PURE__*/_jsx(IconFinder,{iconName:\"Download\"})})]},r))}),downloadPopup&&/*#__PURE__*/_jsx(DownloadPopup,{handleClose:()=>setDownloadPopup(false),heading:downloadPopup})]});};export default/*#__PURE__*/memo(Reports);const DownloadPopup=props=>{const theme=useTheme();const{showSnackbar,hideSnackbar}=useSnackbar();const previousFinancialYears=Array.from({length:3},(_,count)=>\"\".concat(new Date().getFullYear()-count-1,\"-\").concat(new Date().getFullYear()-count)).reverse();const currentFinancialYear=new Date().getMonth()+1<=3?\"\".concat(new Date().getFullYear()-1,\"-\").concat(new Date().getFullYear()):\"\".concat(new Date().getFullYear(),\"-\").concat(new Date().getFullYear()+1);const[anchorEl,setAnchorEl]=useState(null);const[finYear,setFinYear]=useState(currentFinancialYear);const FinancialYear=[...previousFinancialYears,currentFinancialYear];const DownloadReportApi=useDownloadReportApi();const[customerDisbursement,setCustomerDisbursement]=useState('');const[vendorPayment,setVendorPayment]=useState(moment());const[selectedMonthValue,setSelectedMonthValue]=useState('04');const[currentDate,setCurrentDate]=useState(null);const[selectedMonthName,setSelectedMonthName]=useState('');const onDownloadClick=()=>{let info={url:'',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};let info2={url:'',request:{quarter:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};let quartermonts=1;const firstYear=finYear.split('-')[0];console.log(firstYear);console.log(selectedMonthValue);console.log(currentDate);const safeCurrentDate=currentDate||1;const formattedDate=\"\".concat(safeCurrentDate,\"-\").concat(selectedMonthValue,\"-\").concat(firstYear);const vendorPaymentDate=moment(formattedDate,'DD-MM-YYYY');console.log(vendorPaymentDate.format('DD-MM-YYYY'));switch(props.heading){case'Vendor Payment':info={url:'download_vendor_payment_report',request:{date:vendorPaymentDate.format('DD-MM-YYYY')}};break;case'Monthly Restaurant transaction':info={url:'download_monthly_rest_transaction_report',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};break;case'GST Return':info={url:'download_monthly_gst_report',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};break;case'Quarterly TDS Return':if(customerDisbursement==='Apr - Jun'){quartermonts=2;}else if(customerDisbursement==='Jul - Sep'){quartermonts=3;}else if(customerDisbursement==='Oct - Dec'){quartermonts=4;}else if(customerDisbursement==='Jan - Mar'){quartermonts=1;}info2={url:'download_quarterly_tds_report',request:{quarter:quartermonts,year:new Date().getFullYear()}};break;case'Monthly TDS Return':info={url:'download_monthly_tds_report',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};break;case'Restaurant Disbursement':info={url:'download_restaurant_disbursement_report',request:{date:vendorPayment===null||vendorPayment===void 0?void 0:vendorPayment.format('DD-MM-YYYY')}};break;case'Discount Structure Savings':info={url:'download_discount_structure_reports',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};break;case'Restaurant Membership Profit':info={url:'download_restaurant_membership_report',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};break;case'Restaurant Incentive':info={url:'download_restaurant_incentive_report',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};break;case'Customer Disbursement':info={url:'download_customer_disbursement_report',request:{month:moment().month(customerDisbursement).format('M'),year:new Date().getFullYear()}};break;default:break;}DownloadReportApi.mutateAsync(props.heading==='Quarterly TDS Return'?info2:info).then(res=>{var _res$data;window.open(res.data.download_link);showSnackbar({title:'Success!',variant:'sucess',content:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.message,onCancel:()=>hideSnackbar()});}).catch(error=>{var _error$response,_error$response$data;showSnackbar({title:'Error!',variant:'error',content:(_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message,onCancel:()=>hideSnackbar()});});props.handleClose();};const quarters={1:months().splice(3,3),2:months().splice(6,3),3:months().splice(9,3),4:months().splice(0,3)};return/*#__PURE__*/_jsxs(Dialog,{onClose:props.handleClose,open:Boolean(props.heading),sx:{'.MuiPaper-root':{width:\"100%\",minWidth:752}},children:[/*#__PURE__*/_jsx(DialogTitle,{sx:{padding:4,paddingBottom:3},children:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"h6\",fontWeight:600,sx:{color:theme.palette.common.primaryGreyText},children:props.heading})}),/*#__PURE__*/_jsxs(DialogContent,{sx:{display:'flex',flexDirection:'column',gap:6,padding:4},children:[/*#__PURE__*/_jsx(Stack,{flexDirection:'row',children:/*#__PURE__*/_jsxs(PoppinsTypography,{fontSize:18,sx:{color:theme.palette.common.primaryGreyText},children:[\"Financial year\",/*#__PURE__*/_jsx(Button,{endIcon:/*#__PURE__*/_jsx(IconFinder,{iconName:\"ChevronDown\",iconProps:{fill:theme.palette.common.primaryGreyText}}),onClick:e=>setAnchorEl(e.currentTarget),children:/*#__PURE__*/_jsx(PoppinsTypography,{fontSize:18,sx:{color:theme.palette.common.primaryGreyText},children:\" \".concat(finYear)})}),/*#__PURE__*/_jsx(Menu,{anchorEl:anchorEl,open:Boolean(anchorEl),onClose:()=>setAnchorEl(null),children:FinancialYear.map(s=>/*#__PURE__*/_jsx(MenuItem,{onClick:()=>{setFinYear(s);setAnchorEl(null);},children:s},s))})]})}),(props.heading==='Discount Structure Savings'||props.heading==='GST Return'||props.heading==='Monthly TDS Return'||props.heading==='Customer Disbursement'||props.heading==='Restaurant Incentive'||props.heading==='Monthly Restaurant transaction'||props.heading==='Restaurant Membership Profit')&&/*#__PURE__*/_jsx(Stack,{flexDirection:'row',flexWrap:'wrap',gap:1,children:Object.entries(quarters).map(q=>q[1].map(r=>/*#__PURE__*/_jsx(Button,{size:\"large\",variant:customerDisbursement===r?'contained':'outlined',sx:{width:224,height:48},onClick:()=>setCustomerDisbursement(r),disabled:finYear!==currentFinancialYear?false:new Date().getMonth()<Number(moment().month(r).format('M'))||//  new Date() < moment(r, 'MM-DD-YYYY').toDate() ||\n!q[1].map(q=>Number(moment().month(q).format('M'))).includes(new Date().getMonth()),children:/*#__PURE__*/_jsx(PoppinsTypography,{fontSize:18,children:r})},r)))}),props.heading==='Quarterly TDS Return'&&/*#__PURE__*/_jsx(Stack,{flexDirection:'row',flexWrap:'wrap',gap:1,children:[{label:'Apr - Jun',value:quarters[1]},{label:'Jul - Sep',value:quarters[2]},{label:'Oct - Dec',value:quarters[3]},{label:'Jan - Mar',value:quarters[4]}].map(r=>/*#__PURE__*/_jsx(Button,{size:\"large\",variant:customerDisbursement===r.label?'contained':'outlined',sx:{width:224,height:48},onClick:()=>setCustomerDisbursement(r.label),disabled:finYear!==currentFinancialYear?false:new Date().getMonth()+1>4&&r.value[0]==='January'?true:new Date().getMonth()<Math.max(...r.value.map(q=>Number(moment().month(q).format('M')))),children:/*#__PURE__*/_jsx(PoppinsTypography,{fontSize:18,children:r.label})},r.label))}),props.heading==='Restaurant Disbursement'&&/*#__PURE__*/_jsx(LocalizationProvider,{dateAdapter:AdapterMoment,children:/*#__PURE__*/_jsx(DemoContainer,{components:['DatePicker'],sx:{flexDirection:'column-reverse !important',overflow:'hidden',padding:'inherit'},children:/*#__PURE__*/_jsx(StaticDatePicker,{views:['day'],onChange:v=>{setVendorPayment(v);if(v){const dayOfMonth=v.date();const month=(v.month()+1).toString();console.log(month);setCurrentDate(dayOfMonth);setSelectedMonthValue(month);}else{console.log('Date value is null');}},disableFuture:true,defaultCalendarMonth:moment(new Date(2024,0)),sx:{'& .MuiPickersLayout-actionBar':{display:'none'},'& .MuiPickersToolbar-root':{display:'none'},'& .MuiPickersSlideTransition-root':{height:500},'& .MuiPickersLayout-contentWrapper':{height:500},'& .MuiDateCalendar-root':{width:\"100%\",height:\"100%\",display:'contents',paddingBottom:3},'& .MuiDayCalendar-header':{display:'none'},'& .MuiPickersCalendarHeader-root':{display:'visible'},'& .MuiPickersDay-root':{fontSize:\"18px\",fontWeight:600,fontFamily:'Poppins',gap:'12px',width:48,height:48,borderRadius:\"4px\",borderWidth:1,borderStyle:'solid',margin:\"12px\",borderColor:theme.palette.primary.main},'.Mui-disabled':{borderColor:'#C8C8C8'}}})})}),props.heading==='Vendor Payment'&&/*#__PURE__*/_jsxs(LocalizationProvider,{dateAdapter:AdapterMoment,children:[/*#__PURE__*/_jsx(Stack,{flexDirection:'row',flexWrap:'wrap',gap:1}),/*#__PURE__*/_jsx(DemoContainer,{components:['DatePicker'],sx:{flexDirection:'column-reverse !important',overflow:'hidden',padding:'inherit'},children:/*#__PURE__*/_jsx(StaticDatePicker,{views:['day'],onChange:v=>{setVendorPayment(v);if(v){const dayOfMonth=v.date();const month=(v.month()+1).toString();console.log(month);setCurrentDate(dayOfMonth);setSelectedMonthValue(month);}else{console.log('Date value is null');}},disableFuture:true,defaultCalendarMonth:moment(new Date(2024,0)),sx:{'& .MuiPickersLayout-actionBar':{display:'none'},'& .MuiPickersToolbar-root':{display:'none'},'& .MuiPickersSlideTransition-root':{height:500},'& .MuiPickersLayout-contentWrapper':{height:500},'& .MuiDateCalendar-root':{width:\"100%\",height:\"100%\",display:'contents',paddingBottom:3},'& .MuiDayCalendar-header':{display:'none'},'& .MuiPickersCalendarHeader-root':{display:'visible'},'& .MuiPickersDay-root':{fontSize:\"18px\",fontWeight:600,fontFamily:'Poppins',gap:'12px',width:48,height:48,borderRadius:\"4px\",borderWidth:1,borderStyle:'solid',margin:\"12px\",borderColor:theme.palette.primary.main},'.Mui-disabled':{borderColor:'#C8C8C8'}}})})]}),/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',gap:2,alignSelf:'self-end',children:[/*#__PURE__*/_jsx(LoadingButton,{variant:\"outlined\",size:\"large\",sx:{width:166},onClick:props.handleClose,children:/*#__PURE__*/_jsx(PoppinsTypography,{fontSize:18,sx:{color:theme.palette.common.primaryGreyText},children:\"Cancel\"})}),/*#__PURE__*/_jsx(LoadingButton,{variant:\"contained\",size:\"large\",sx:{width:166},onClick:onDownloadClick,children:/*#__PURE__*/_jsx(PoppinsTypography,{fontSize:18,children:\"Download\"})})]})]})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}