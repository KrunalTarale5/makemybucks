{"ast":null,"code":"import{useSnackbar}from'@components/Snackbar';import{PoppinsTypography}from'@components/Typography';import{useDownloadQRApi,useGetQRBgUrlsApi,useUpdateQRBgApi}from'@hooks/admin-qrcode';import{LoadingButton}from'@mui/lab';import{Button,Dialog,DialogContent,DialogTitle,FormControl,FormControlLabel,Radio,RadioGroup,Stack,useTheme}from'@mui/material';import{memo,useState}from'react';import{useAlertDialog}from'@components/AlertDialog';import JSZip from'jszip';import QRCode from'qrcode';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const BUTTONS=[5,500,1000,2000,3000,4000,5000,6000];const IMAGES=[{label:'Image1',value:'bg_url_1'},{label:'Image2',value:'bg_url_2'},{label:'Image3',value:'bg_url_3'}];const QR_CONFIG={x:370,// X position of QR code on banner (in pixels)\ny:900,// Y position of QR code on banner (in pixels)\nsize:500,// Size of QR code (in pixels)\nmargin:0,// Margin around QR code\ntext:{x:250,// X position of text\ny:500,// Y position of text (middle of QR)\nfont:'bold 38px Arial',// Font style\ncolor:'#70778b'// Text color\n}};const generateCustomQrOnBanner=async _ref=>{let{stringToCreateQR,bannerImg,bannerText}=_ref;const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');if(!ctx)throw new Error('Canvas context not available');const backgroundImage=await new Promise((resolve,reject)=>{const img=new Image();img.crossOrigin='anonymous';img.onload=()=>resolve(img);img.onerror=reject;img.src=bannerImg;});canvas.width=backgroundImage.width;canvas.height=backgroundImage.height;// Draw background\nctx.drawImage(backgroundImage,0,0);// Generate QR code with transparent background\nconst qrCanvas=document.createElement('canvas');const qrCtx=qrCanvas.getContext('2d');if(!qrCtx)throw new Error('QR Canvas context not available');// Set QR canvas size\nqrCanvas.width=QR_CONFIG.size;qrCanvas.height=QR_CONFIG.size;// Generate QR code\nconst qrCodeDataURL=await QRCode.toCanvas(qrCanvas,stringToCreateQR,{width:QR_CONFIG.size,margin:QR_CONFIG.margin,color:{dark:'#000000',light:'#ffffff00'// Transparent background\n}});// Draw QR code onto main canvas\nctx.drawImage(qrCanvas,QR_CONFIG.x,QR_CONFIG.y,QR_CONFIG.size,QR_CONFIG.size);// Add text vertically\nctx.save();ctx.translate(QR_CONFIG.x-30,QR_CONFIG.y+QR_CONFIG.size-145);ctx.rotate(-Math.PI/2);ctx.font=QR_CONFIG.text.font;ctx.fillStyle=QR_CONFIG.text.color;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(bannerText,0,0);ctx.restore();const blob=await new Promise(resolve=>{canvas.toBlob(blob=>{if(blob)resolve(blob);},'image/png');});return{blob,bannerText};};const DownloadQrCode=props=>{var _GetQRBgUrlsApi$data$2,_GetQRBgUrlsApi$data3;const theme=useTheme();const{showSnackbar,hideSnackbar}=useSnackbar();const{showAlertDialog,hideAlertDialog}=useAlertDialog();const GetQRBgUrlsApi=useGetQRBgUrlsApi();const DownloadQRApi=useDownloadQRApi();const[selectedButton,setSelectedButton]=useState(null);const[selectedImage,setSelectedImage]=useState(null);const[openQRBgDialog,setOpenQRBgDialog]=useState(null);const[isDownloading,setIsDownloading]=useState(false);const zip=new JSZip();const OnDownloadClick=()=>{var _GetQRBgUrlsApi$data$,_GetQRBgUrlsApi$data;const selectedImgUrl=(_GetQRBgUrlsApi$data$=(_GetQRBgUrlsApi$data=GetQRBgUrlsApi.data)===null||_GetQRBgUrlsApi$data===void 0?void 0:_GetQRBgUrlsApi$data.data.bg_urls[IMAGES.findIndex(i=>i.value===(selectedImage===null||selectedImage===void 0?void 0:selectedImage.value))])!==null&&_GetQRBgUrlsApi$data$!==void 0?_GetQRBgUrlsApi$data$:'';if(!selectedImgUrl){showAlertDialog({title:\"Download QR Code\",content:'No image associated with the selected image.',buttons:[{children:'ok',variant:'outlined',callback:()=>{hideAlertDialog();}}]});return;}setIsDownloading(true);showAlertDialog({title:\"Download QR Code\",content:'Are Your sure you want to download QR Code?',buttons:[{children:'Cancel',variant:'outlined',callback:()=>{hideAlertDialog();}},{children:'Download',variant:'contained',callback:()=>{hideAlertDialog();void DownloadQRApi.mutateAsync({request:{number:selectedButton}}).then(response=>{Promise.all(response.data.download_list.map(code=>generateCustomQrOnBanner({stringToCreateQR:\"\".concat(String(process.env.REACT_APP_PAYMENT_URL)).concat(code.qr_id),bannerImg:selectedImgUrl,bannerText:code.qr_id}))).then(a=>{a.map(x=>{zip.file(\"\".concat(x.bannerText,\".png\"),x.blob,{binary:true});});zip.generateAsync({type:'blob'}).then(blobdata=>{const elem=window.document.createElement('a');elem.href=window.URL.createObjectURL(new Blob([blobdata]));elem.download='qrcodes.zip';elem.click();}).then(()=>{setIsDownloading(false);props.refetch();}).catch(()=>{setIsDownloading(false);});}).catch(()=>{setIsDownloading(false);});}).catch(error=>{var _error$response,_error$response$data;setIsDownloading(false);showSnackbar({title:'Error!',variant:'error',content:(_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message,onCancel:()=>hideSnackbar()});});}}]});};return/*#__PURE__*/_jsxs(Stack,{gap:1,children:[/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",sx:{color:theme.palette.common.secondaryGreyText},children:\"Select Number\"}),/*#__PURE__*/_jsxs(Stack,{gap:5,children:[/*#__PURE__*/_jsx(Stack,{flexDirection:'row',gap:1,children:BUTTONS.map((l,index)=>/*#__PURE__*/_jsx(Button,{size:\"large\",variant:selectedButton===l?'contained':'outlined',color:\"primary\",sx:{...(selectedButton===l&&{borderColor:'#DFE3ED'}),width:100,height:40,borderRadius:'8px'},onClick:()=>setSelectedButton(l),children:l},index))}),/*#__PURE__*/_jsxs(Stack,{children:[/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",sx:{color:theme.palette.common.secondaryGreyText},children:\"Select Image\"}),/*#__PURE__*/_jsx(FormControl,{children:/*#__PURE__*/_jsx(RadioGroup,{row:true,value:selectedImage===null||selectedImage===void 0?void 0:selectedImage.value,onChange:e=>{var _IMAGES$find;return setSelectedImage((_IMAGES$find=IMAGES.find(i=>i.value===e.target.value))!==null&&_IMAGES$find!==void 0?_IMAGES$find:null);},sx:{gap:2},children:IMAGES.map((l,index)=>{var _GetQRBgUrlsApi$data2;return/*#__PURE__*/_jsx(FormControlLabel,{value:l.value,control:/*#__PURE__*/_jsx(Radio,{size:\"medium\"}),label:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"h6\",sx:{color:(_GetQRBgUrlsApi$data2=GetQRBgUrlsApi.data)!==null&&_GetQRBgUrlsApi$data2!==void 0&&_GetQRBgUrlsApi$data2.data.bg_urls[index]?theme.palette.success.main:theme.palette.common.secondaryGreyText},onClick:()=>setOpenQRBgDialog({label:l.label,value:String(index)}),children:l.label})},index);})})})]}),/*#__PURE__*/_jsx(LoadingButton,{size:\"large\",variant:\"contained\",color:\"primary\",sx:{width:209,height:51,borderRadius:'8px'},disabled:selectedButton===null||selectedImage===null,loading:isDownloading,onClick:OnDownloadClick,children:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",children:\"Download QR\"})})]}),/*#__PURE__*/_jsx(HandleQRBgImageDialog,{imageUrl:(_GetQRBgUrlsApi$data$2=(_GetQRBgUrlsApi$data3=GetQRBgUrlsApi.data)===null||_GetQRBgUrlsApi$data3===void 0?void 0:_GetQRBgUrlsApi$data3.data.bg_urls[Number(openQRBgDialog===null||openQRBgDialog===void 0?void 0:openQRBgDialog.value)])!==null&&_GetQRBgUrlsApi$data$2!==void 0?_GetQRBgUrlsApi$data$2:'',openQRBgDialog:openQRBgDialog,handleClose:()=>setOpenQRBgDialog(null),refetch:()=>void GetQRBgUrlsApi.refetch()})]});};export default/*#__PURE__*/memo(DownloadQrCode);const HandleQRBgImageDialog=props=>{var _props$openQRBgDialog2;const theme=useTheme();const{showSnackbar,hideSnackbar}=useSnackbar();const UpdateQRBgApi=useUpdateQRBgApi();const onChange=event=>{var _props$openQRBgDialog;UpdateQRBgApi.mutateAsync({request:{[\"bg_url_\".concat(Number((_props$openQRBgDialog=props.openQRBgDialog)===null||_props$openQRBgDialog===void 0?void 0:_props$openQRBgDialog.value)+1)]:event.target.files}}).then(response=>{var _response$data,_props$handleClose;showSnackbar({title:'Success!',variant:'sucess',content:(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.message,onCancel:()=>hideSnackbar()});props.refetch();(_props$handleClose=props.handleClose)===null||_props$handleClose===void 0?void 0:_props$handleClose.call(props);}).catch(error=>{var _error$response2,_error$response2$data;showSnackbar({title:'Error!',variant:'error',content:(_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message,onCancel:()=>hideSnackbar()});});};return/*#__PURE__*/_jsxs(Dialog,{onClose:props.handleClose,open:Boolean(props.openQRBgDialog),maxWidth:\"sm\",sx:{'.MuiPaper-root':{width:\"100%\"}},children:[/*#__PURE__*/_jsx(DialogTitle,{sx:{padding:4,paddingBottom:3},children:/*#__PURE__*/_jsxs(PoppinsTypography,{variant:\"h5\",sx:{color:theme.palette.common.primaryGreyText},children:[\"QR Background \",(_props$openQRBgDialog2=props.openQRBgDialog)===null||_props$openQRBgDialog2===void 0?void 0:_props$openQRBgDialog2.label]})}),/*#__PURE__*/_jsxs(DialogContent,{sx:{display:'flex',alignItems:'center',flexDirection:'column',gap:6,padding:4},children:[props.imageUrl?/*#__PURE__*/_jsx(\"img\",{width:206,height:333,src:props.imageUrl}):/*#__PURE__*/_jsx(Stack,{width:206,height:333,sx:{backgroundColor:'#DFE3ED'},justifyContent:'center',alignItems:'center',children:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"subtitle1\",children:\"No Image Found\"})}),/*#__PURE__*/_jsxs(Stack,{flexDirection:'row',gap:2,alignSelf:'self-end',children:[/*#__PURE__*/_jsx(LoadingButton,{variant:\"outlined\",size:\"large\",sx:{width:245},onClick:props.handleClose,children:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"h5\",sx:{color:theme.palette.common.primaryGreyText},children:\"Back\"})}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:\"upoload-qr-bg\",children:[/*#__PURE__*/_jsx(\"input\",{id:\"upoload-qr-bg\",name:\"upoload-qr-bg\",style:{opacity:0,position:'absolute',width:'inherit',height:'inherit'},type:\"file\",onChange:onChange,onClick:event=>event.currentTarget.value=''}),/*#__PURE__*/_jsx(LoadingButton,{component:\"span\",variant:\"contained\",size:\"large\",sx:{width:245},loading:UpdateQRBgApi.isLoading,children:/*#__PURE__*/_jsx(PoppinsTypography,{variant:\"h5\",children:props.imageUrl?'Update Image':'Upload Image'})})]})]})]})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}